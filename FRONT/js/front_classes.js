/**
 * Created by Daniel on 1/30/2017.
 */


var windowSize = {width: $(window).width(), height: $(window).height()};
function PercentW(perc) {
    return windowSize.width*(perc/100);
}
function PercentH(perc) {
    return windowSize.height*(perc/100);
}


class MalwareWindow {
    constructor(fabricCanvas,level=1) {
        this.level = level;
        this.canvas = fabricCanvas;
        this.parent;
        this.mainObject;
        this.objects = new Array();
    }

    addAllToCanvas() {
        for (var i=0; i<this.objects.length; i++)
            this.canvas.add(this.objects[i].obj);
        if (typeof(this.mainObject)!='undefined')
            this.canvas.add(this.mainObject.obj);
        this.canvas.renderAll();
    }

    setMainObject(obj) {
        this.mainObject = new WindowMainObject(obj,'main');
    }

    addObjects(objArray) {
        for (var i=0; i<objArray.length; i++)
            this.addObject(objArray[i]);
    }

    addObject(obj) {
        this.objects.push( new WindowObject(obj) );
    }

    distributeObjects() {
        var angleBetween = 360/this.objects.length;
        var centerMain = {
            x: this.mainObject.obj.left+this.mainObject.obj.width/2,
            y: this.mainObject.obj.top+this.mainObject.obj.height/2
        };

        var startAngle = -90;
        var radius = 200;
        for (var i=0; i<this.objects.length; i++)
            {
            var radians = startAngle * (Math.PI/180);
            var x = centerMain.x + radius * Math.cos(radians);
            var y = centerMain.y + radius * Math.sin(radians);
            this.objects[i].centerOn(x,y);
            startAngle+= angleBetween;
            }
        this.canvas.renderAll();

    }

}

class WindowObject {
    constructor(text,type='secondary') {
        this.type = type;
        this.text = text;
        this.obj = this.constructObject();
    }

    constructObject() {
        var text = new fabric.Text(this.text, {
            fontSize: 20,
            originX: 'center',
            originY: 'center',
        });

        var rect = new fabric.Rect({
            stroke: 'black',
            fill: 'white',
            originX: 'center',
            originY: 'center',
            width: text.getWidth()+10,
            height: text.getHeight()+10,
        });

        var groupRect = new fabric.Group([rect,text], {
            originX: 'left',
            originY: 'top',
            left: PercentW(20)-rect.width/2,
            top: PercentH(20)-rect.height/2
        });

        groupRect.set('selectable', false);
        return groupRect;
    }

    centerOn(x,y) {
        this.obj.setLeft(x-this.obj.width/2);
        this.obj.setTop(y-this.obj.height/2);
    }
}

class WindowMainObject extends WindowObject {
    constructObject() {
        var text = new fabric.Text(this.text, {
            fontSize: 30,
            originX: 'center',
            originY: 'center',
        });

        var rect = new fabric.Rect({
            stroke: 'black',
            fill: 'white',
            originX: 'center',
            originY: 'center',
            width: text.getWidth()+30,
            height: text.getHeight()+30,
        });

        var groupRect = new fabric.Group([rect,text], {
            originX: 'left',
            originY: 'top',
            left: PercentW(50)-rect.width/2,
            top: PercentH(50)-rect.height/2
        });

        groupRect.set('selectable', false);
        return groupRect;
    }
}



