/**
 * Created by Daniel on 1/30/2017.
 */


var windowSize = {width: $(window).width(), height: $(window).height()};
function PercentW(perc) {
    return windowSize.width*(perc/100);
}
function PercentH(perc) {
    return windowSize.height*(perc/100);
}


class MalwareWindow {
    constructor(fabricCanvas,level=1) {
        this.level = level;
        this.canvas = fabricCanvas;
        this.parent;
        this.mainObject;
        this.objects = new Array();
    }

    addAllToCanvas() {
        for (var i=0; i<this.objects.length; i++)
            this.canvas.add(this.objects[i].obj);
        if (typeof(this.mainObject)!='undefined')
            this.canvas.add(this.mainObject.obj);
        this.canvas.renderAll();
    }

    setMainObject(obj) {
        this.mainObject = new WindowMainObject(obj,'main');
    }

    addObjects(objArray) {
        for (var i=0; i<objArray.length; i++)
            this.addObject(objArray[i]);
    }

    addObject(obj) {
        this.objects.push( new WindowObject(obj) );
    }
    
}

class WindowObject {
    constructor(text,type='secondary') {
        this.type = type;
        this.text = text;
        this.obj = this.constructObject();
    }

    constructObject() {
        var text = new fabric.Text(this.text, {
            fontSize: 20,
            originX: 'center',
            originY: 'center',
        });

        var rect = new fabric.Rect({
            stroke: 'black',
            fill: 'white',
            originX: 'center',
            originY: 'center',
            width: text.getWidth()+10,
            height: text.getHeight()+10,
        });

        var groupRect = new fabric.Group([rect,text], {
            originX: 'left',
            originY: 'top',
            left: PercentW(20)-rect.width/2,
            top: PercentH(20)-rect.height/2
        });

        groupRect.set('selectable', false);
        return groupRect;
    }
}

class WindowMainObject extends WindowObject {
    constructObject() {
        var text = new fabric.Text(this.text, {
            fontSize: 30,
            originX: 'center',
            originY: 'center',
        });

        var rect = new fabric.Rect({
            stroke: 'black',
            fill: 'white',
            originX: 'center',
            originY: 'center',
            width: text.getWidth()+30,
            height: text.getHeight()+30,
        });

        var groupRect = new fabric.Group([rect,text], {
            originX: 'left',
            originY: 'top',
            left: PercentW(50)-rect.width/2,
            top: PercentH(50)-rect.height/2
        });

        groupRect.set('selectable', false);
        return groupRect;
    }
}



